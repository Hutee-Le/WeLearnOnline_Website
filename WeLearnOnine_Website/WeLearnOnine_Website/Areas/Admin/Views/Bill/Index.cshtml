@model IEnumerable<WeLearnOnine_Website.Models.Bill>

@{
    ViewData["Title"] = "ListStaff";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

@if (TempData["staffError"] != null)
{
    <div class="bs-toast toast toast-placement-ex m-2 fade bg-success top-0 end-0 show" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="bx bx-bell me-2"></i>
            <div class="me-auto fw-medium">Notification</div>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">@TempData["staffError"]</div>
    </div>
}
@if (TempData["staffSuccess"] != null)
{
    <div class="bs-toast toast toast-placement-ex m-2 fade bg-success top-0 end-0 show" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="bx bx-bell me-2"></i>
            <div class="me-auto fw-medium">Notification</div>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">@TempData["staffSuccess"]</div>
    </div>
}


<h4 class="py-3 mb-4"><span class="text-muted fw-light">Bill /</span> Bill Table</h4>
<div class="card"> 
        <div class="col-md-12">
            <div class="nav-align-top mb-4">
            <h6 class="text-muted mt-2 d-flex justify-content-center">Payment Status</h6>
            <ul class="nav nav-pills justify-content-center" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button type="button" class="nav-link active" role="tab" data-bs-toggle="tab" data-bs-target="#navs-pills-top-All" aria-controls="navs-pills-top-All" aria-selected="true" tabindex="-1">
                            All
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button type="button" class="nav-link" role="tab" data-bs-toggle="tab" data-bs-target="#navs-pills-top-Successful" aria-controls="navs-pills-top-Successful" aria-selected="false" tabindex="-1">
                            Successful
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button type="button" class="nav-link" role="tab" data-bs-toggle="tab" data-bs-target="#navs-pills-top-Pending" aria-controls="navs-pills-top-Pending" aria-selected="false">
                            Pending
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button type="button" class="nav-link" role="tab" data-bs-toggle="tab" data-bs-target="#navs-pills-top-Fail" aria-controls="navs-pills-top-Fail" aria-selected="false">
                            Fail
                        </button>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade active show" id="navs-pills-top-All" role="tabpanel">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>
                                        ID 
                                    </th>
                                    <th>
                                        User Name
                                    </th>
                                    <th>
                                        Bill Date
                                    </th>
                                    <th>
                                        Due Date
                                    </th>
                                     <th>
                                        Payment
                                    </th>
                                    <th>
                                        Total Amount (VNĐ)
                                    </th>
                                    <th>
                                        Status Payment
                                    </th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr style="text-align: center">
                                    @{
                                        string statusClass = "bg-label-info";

                                        if (item.Status == "Payment Successful")
                                        {
                                            statusClass = "bg-label-success";
                                        }
                                        else if (item.Status == "Pending")
                                        {
                                            statusClass = "bg-label-primary";
                                        }
                                        else if (item.Status == "Payment Fail")
                                        {
                                            statusClass = "bg-label-danger";
                                        }
                                    }
                                   @* <td><span>@GetUserName(item.UserId)</span></td>
                                    <!-- Các phần khác của view -->
                                    @functions {
                                    // Hàm để lấy tên người dùng từ danh sách UserNames
                                    public string GetUserName(int? userId)
                                    {
                                        var userNames = (IEnumerable<User>)((SelectList)ViewBag.UserNames).Items;
                                        var user = userNames.FirstOrDefault(u => u.UserId == userId);
                                        return user?.UserName ?? "Unknown";
                                    }
                                }*@

                                        <td>@(item.BillId.ToString().Length >= 8 ? item.BillId.ToString().Substring(0, 8) : item.BillId.ToString())</td>
                                        <td>@item.UserId</td>
                                        <td>@item.CreateAt</td>
                                        <td>@item.ExpirationDate</td>
                                        <td>@item.PaymentMethod</td>
                                        <td>@item.Total.ToString("#,##0")</td>
                                        <td>
                                            <span class="badge me-1 @statusClass">@item.Status</span>
                                        </td>
                                        <td>
                                            <a class="btn btn-info btn-show" href="#" type="button" data-bs-toggle="modal" data-bs-target="#myModal-All-@item.BillId">Show</a>
                                        </td>
                                    </tr>

                                    <div class="modal fade" id="myModal-All-@item.BillId">
                                        <div class="modal-dialog modal-xl">
                                            <div class="modal-content">
                                                <div class="modal-body" id="modal-content-@item.BillId">
                                                    @await Html.PartialAsync("_BillDetailsViewPartial", item)
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="tab-pane fade" id="navs-pills-top-Successful" role="tabpanel">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                    <th>
                                        ID 
                                    </th>
                                    <th>
                                        User Name
                                    </th>
                                    <th>
                                        Bill Date
                                    </th>
                                    <th>
                                        Due Date
                                    </th>
                                     <th>
                                        Payment
                                    </th>
                                    <th>
                                        Total Amount (VNĐ)
                                    </th>
                                    <th>
                                        Status Payment
                                    </th>
                                    <th>Actions</th>
                                </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Where(m => m.Status == "Payment Successful"))
                            {
                                <tr style="text-align: center">
                                    @{
                                        string statusClass = "bg-label-info";

                                        if (item.Status == "Payment Successful")
                                        {
                                            statusClass = "bg-label-success";
                                        }
                                        else if (item.Status == "Pending")
                                        {
                                            statusClass = "bg-label-primary";
                                        }
                                        else if (item.Status == "Payment Fail")
                                        {
                                            statusClass = "bg-label-danger";
                                        }
                                    }
                                     <td>@(item.BillId.ToString().Length >= 8 ? item.BillId.ToString().Substring(0, 8) : item.BillId.ToString())</td>
                                        <td>@item.UserId</td>
                                        <td>@item.CreateAt</td>
                                        <td>@item.ExpirationDate</td>
                                        <td>@item.PaymentMethod</td>
                                        <td>@item.Total.ToString("#,##0")</td>
                                        <td>
                                            <span class="badge me-1 @statusClass">@item.Status</span>
                                        </td>
                                    <td>
                                        <a class="btn btn-info btn-show" href="#" type="button" data-bs-toggle="modal" data-bs-target="#myModal-Successful-@item.BillId">Show</a>
                                    </td>
                                </tr>

                                @* Small Model Details *@
                                <div class="modal fade" id="myModal-Successful-@item.BillId">
                                    <div class="modal-dialog modal-xl">
                                        <div class="modal-content">
                                            <div class="modal-body" id="modal-content-Successful-@item.BillId">
                                                @await Html.PartialAsync("_BillDetailsViewPartial", item)
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </tbody>
                    </table>
                    </div>
                    <div class="tab-pane fade" id="navs-pills-top-Pending" role="tabpanel">
                        <table class="table table-bordered">
                        <thead>
                           <tr>
                                    <th>
                                        ID 
                                    </th>
                                    <th>
                                        User Name
                                    </th>
                                    <th>
                                        Bill Date
                                    </th>
                                    <th>
                                        Due Date
                                    </th>
                                     <th>
                                        Payment
                                    </th>
                                    <th>
                                        Total Amount (VNĐ)
                                    </th>
                                    <th>
                                        Status Payment
                                    </th>
                                    <th>Actions</th>
                                </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Where(m => m.Status == "Pending"))
                            {
                                <tr style="text-align: center">
                                    @{
                                        string statusClass = "bg-label-info";

                                        if (item.Status == "Payment Successful")
                                        {
                                            statusClass = "bg-label-success";
                                        }
                                        else if (item.Status == "Pending")
                                        {
                                            statusClass = "bg-label-primary";
                                        }
                                        else if (item.Status == "Payment Fail")
                                        {
                                            statusClass = "bg-label-danger";
                                        }
                                    }
                                  @*  <td><span>@GetUserName(item.UserId)</span></td>
                                    <!-- Các phần khác của view -->
                                    @functions {
                                    // Hàm để lấy tên người dùng từ danh sách UserNames
                                    public string GetUserName(int? userId)
                                    {
                                        var userNames = (IEnumerable<User>)((SelectList)ViewBag.UserNames).Items;
                                        var user = userNames.FirstOrDefault(u => u.UserId == userId);
                                        return user?.UserName ?? "Unknown";
                                    }
                                }*@
                                      <td>@(item.BillId.ToString().Length >= 8 ? item.BillId.ToString().Substring(0, 8) : item.BillId.ToString())</td>
                                        <td>@item.UserId</td>
                                        <td>@item.CreateAt</td>
                                        <td>@item.ExpirationDate</td>
                                        <td>@item.PaymentMethod</td>
                                        <td>@item.Total.ToString("#,##0")</td>
                                        <td>
                                            <span class="badge me-1 @statusClass">@item.Status</span>
                                        </td>
                                    <td>
                                        <a class="btn btn-info btn-show" href="#" type="button" data-bs-toggle="modal" data-bs-target="#myModal-Pending-@item.BillId">Show</a>
                                    </td>
                                </tr>

                                @* Small Model Details *@
                                <div class="modal fade" id="myModal-Pending-@item.BillId">
                                    <div class="modal-dialog modal-xl">
                                        <div class="modal-content">
                                            <div class="modal-body" id="modal-content-@item.BillId">
                                                @await Html.PartialAsync("_BillDetailsViewPartial", item)
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </tbody>
                    </table>
                    </div>
                    <div class="tab-pane fade" id="navs-pills-top-Fail" role="tabpanel">
                        <table class="table table-bordered">
                        <thead>
                           <tr>
                                    <th>
                                        ID 
                                    </th>
                                    <th>
                                        User Name
                                    </th>
                                    <th>
                                        Bill Date
                                    </th>
                                    <th>
                                        Due Date
                                    </th>
                                     <th>
                                        Payment
                                    </th>
                                    <th>
                                        Total Amount (VNĐ)
                                    </th>
                                    <th>
                                        Status Payment
                                    </th>
                                    <th>Actions</th>
                                </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Where(m => m.Status == "Payment Fail"))
                            {
                                <tr style="text-align: center">
                                    @{
                                        string statusClass = "bg-label-info";

                                        if (item.Status == "Payment Successful")
                                        {
                                            statusClass = "bg-label-success";
                                        }
                                        else if (item.Status == "Pending")
                                        {
                                            statusClass = "bg-label-primary";
                                        }
                                        else if (item.Status == "Payment Fail")
                                        {
                                            statusClass = "bg-label-danger";
                                        }
                                    }
                                    <td>@(item.BillId.ToString().Length >= 8 ? item.BillId.ToString().Substring(0, 8) : item.BillId.ToString())</td>
                                        <td>@item.UserId</td>
                                        <td>@item.CreateAt</td>
                                        <td>@item.ExpirationDate</td>
                                        <td>@item.PaymentMethod</td>
                                        <td>@item.Total.ToString("#,##0")</td>
                                        <td>
                                            <span class="badge me-1 @statusClass">@item.Status</span>
                                        </td>
                                    <td>
                                        <a class="btn btn-info btn-show" href="#" type="button" data-bs-toggle="modal" data-bs-target="#myModal-Fail-@item.BillId">Show</a>
                                    </td>
                                </tr>

                                @* Small Model Details *@
                                <div class="modal fade" id="myModal-Fail-@item.BillId">
                                    <div class="modal-dialog modal-xl">
                                        <div class="modal-content">
                                            <div class="modal-body" id="modal-content-@item.BillId">
                                                @await Html.PartialAsync("_BillDetailsViewPartial", item)
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </tbody>
                    </table>
                    </div>
                </div>
            </div>
        </div>


       @*  <div class="col-xl-6">
            <h6 class="text-muted">Payment</h6>
            <div class="nav-align-top mb-4">
                <ul class="nav nav-pills mb-3" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button type="button" class="nav-link" role="tab" data-bs-toggle="tab" data-bs-target="#navs-pills-top-All" aria-controls="navs-pills-top-All" aria-selected="false" tabindex="-1">
                            All
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button type="button" class="nav-link" role="tab" data-bs-toggle="tab" data-bs-target="#navs-pills-top-Successful" aria-controls="navs-pills-top-Successful" aria-selected="false" tabindex="-1">
                            Successful
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button type="button" class="nav-link active" role="tab" data-bs-toggle="tab" data-bs-target="#navs-pills-top-Pending" aria-controls="navs-pills-top-Pending" aria-selected="true">
                            Pending
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button type="button" class="nav-link active" role="tab" data-bs-toggle="tab" data-bs-target="#navs-pills-top-Fail" aria-controls="navs-pills-top-Fail" aria-selected="true">
                            Fail
                        </button>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade" id="navs-pills-top-All" role="tabpanel">
                        //for each table in here
                    </div>
                    <div class="tab-pane fade" id="navs-pills-top-Successful" role="tabpanel">
                        //for each table in here
                    </div>
                    <div class="tab-pane fade" id="navs-pills-top-Pending" role="tabpanel">
                        //for each table in here
                    </div>
                    <div class="tab-pane fade active show" id="navs-pills-top-Fail" role="tabpanel">
                        //for each table in here
                    </div>
                </div>
            </div>
        </div> *@


   @*  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        $(document).ready(function () {
            $(".btn-show").click(function () {
                // Lấy ID của Bill từ data attribute
                var billId = $(this).data("bill-id");

                // Đặt giá trị ID vào modal để có thể sử dụng trong modal
                $("#myModal").data("bill-id", billId);

                // Gọi hàm hiển thị nội dung modal
                showBillDetailsModal();
            });

            function showBillDetailsModal() {
                // Lấy ID của Bill từ data attribute của modal
                var billId = $("#myModal").data("bill-id");

                // Sử dụng AJAX để tải nội dung chi tiết Bill
                $.ajax({
                    url: "/Bill/BillDetailsView", // Thay đổi đường dẫn tương ứng
                    type: "GET",
                    data: { id: billId },
                    success: function (data) {
                        // Hiển thị nội dung chi tiết trong modal
                        $("#modal-content").html(data);

                        // Hiển thị modal
                        $("#myModal").modal("show");
                    },
                    error: function () {
                        alert("Failed to retrieve Bill details.");
                    }
                });
            }
        });
    </script> *@


        <!-- Hiển thị phân trang -->
        @* <nav aria-label="..." class="d-flex justify-content-center" style="margin-top: 20px">
            <ul class="pagination">
                @if (ViewBag.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.CurrentPage - 1 })" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                }

                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                {
                    <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>
                    </li>
                }

                @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.CurrentPage + 1 })" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                }
            </ul>
        </nav> *@
        <!-- Hiển thị phân trang -->

    </div>


@* 
<h5 class="card-header">Staffs Table</h5>
<div class="card-body">
    <div class="table-responsive text-nowrap">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>
                        User
                    </th>
                    <th>
                        Total Cost (VNĐ)
                    </th>
                    <th>
                        Create At
                    </th>
                    <th>
                        Card Holder
                    </th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr style="text-align: center">

                        <td><span>@item.User.UserName</span></td>
                        <td>
                    <span class="badge me-1 @staffClass">
                    @item.Role
                    </span>
                    </td>
                        <td>@item.Total.ToString("#,##0")</td>
                        <td>@item.CreateAt</td>
                        <td>@item.CardHolderName</td>
                         <td>@item.Status</td>
                        <td class="hidetext">
                    <p>@item.Experience</p>
                    <button class="expand-button" style="display: none; border: none; width: 20px; height: 20px; background-color: transparent">&#9660;</button>
                    </td>
                        <td>
                            <a class="btn btn-info btn-show" href="#" type="button" data-bs-toggle="modal" data-bs-target="#myModal-@item.BillId">Show</a>
                        </td>
                    </tr>
                    <div class="modal fade" id="myModal-@item.BillId">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content">
                                <div class="modal-body" id="modal-content-@item.BillId">
                                    @await Html.PartialAsync("_BillDetailsViewPartial", item)
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </tbody>
        </table>
    </div>
 *@